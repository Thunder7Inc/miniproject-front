<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Coupon</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            background-color: hsl(0, 0%, 100%);
            color: hsl(240, 10%, 3.9%);
            font-family: 'Inter', sans-serif;
        }

        .bg-background {
            background-color: hsl(0, 0%, 100%);
        }

        .text-muted-foreground {
            color: hsl(240, 3.8%, 45%);
        }

        .text-foreground {
            color: hsl(240, 10%, 3.9%);
        }

        .bg-muted {
            background-color: hsl(240, 4.8%, 95.9%);
        }

        .border-none {
            border: none;
        }

        .focus-ring-0:focus {
            box-shadow: none;
        }

        .rounded-md {
            border-radius: 0.5rem;
        }

        .shadow-lg {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .form-container {
            padding: 1.5rem 2rem;
        }

        .form-control {
            flex-grow: 1;
        }

        .gap-3 {
            gap: 1rem;
        }

        .gap-4 {
            gap: 1.5rem;
        }

        .mt-8 {
            margin-top: 2rem;
        }

        .text-center {
            text-align: center;
        }

        .space-y-4>*+* {
            margin-top: 1rem;
        }

        .d-flex {
            display: flex;
        }

        .align-items-center {
            align-items: center;
        }
    </style>
</head>

<body>
<nav class="navbar navbar-expand-lg bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand text-light" href="#">
            <img src="https://getbootstrap.com/docs/5.2/assets/brand/bootstrap-logo.svg" alt="Logo" width="30"
                 height="24" class="d-inline-block align-text-top">
            Violet Bus
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01"
                aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
            <form class="d-flex justify-content-center ms-auto" role="search">
                <a href="../logout.html" class="btn btn-danger mx-2">Logout</a>
            </form>
        </div>
    </div>
</nav>

<div class="container mt-5">
    <div class="max-w-2xl mx-auto bg-background rounded-lg shadow-lg form-container">
        <div class="text-center space-y-4">
            <h1 class="text-3xl font-heading">Add Coupon</h1>
            <p class="text-muted-foreground">Enter the coupon details to add a new coupon.</p>
        </div>
        <div id="alertContainerCoupon"></div> <!-- Container for coupon alerts -->
        <form id="addCouponForm" class="mt-8">
            <div class="form-group d-flex align-items-center gap-3 bg-muted rounded-md px-4 py-3 my-3">
                <select id="busId" class="form-control border-none focus-ring-0 bg-transparent" required>
                    <option value="">Select Bus</option>
                </select>
            </div>
            <div class="form-group d-flex align-items-center gap-3 bg-muted rounded-md px-4 py-3 my-3">
                <input type="text" id="code" class="form-control border-none focus-ring-0 bg-transparent"
                       placeholder="Coupon Code" required>
            </div>
            <div class="form-group d-flex align-items-center gap-3 bg-muted rounded-md px-4 py-3 my-3">
                <input type="number" id="discountPercentage" class="form-control border-none focus-ring-0 bg-transparent"
                       placeholder="Discount Percentage" required>
            </div>
            <div class="form-group d-flex align-items-center gap-3 bg-muted rounded-md px-4 py-3 my-3">
                <input type="datetime-local" id="expiryDate" class="form-control border-none focus-ring-0 bg-transparent"
                       placeholder="Expiry Date" required>
            </div>
            <div class="form-group d-flex align-items-center gap-3 bg-muted rounded-md px-4 py-3 my-3">
                <input type="number" id="redemptionLimit" class="form-control border-none focus-ring-0 bg-transparent"
                       placeholder="Redemption Limit" required>
            </div>
            <button type="submit" class="btn btn-primary btn-block mt-4">Add Coupon</button>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
</script>
<script>
    document.getElementById('addCouponForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const code = document.getElementById('code').value;
        const discountPercentage = document.getElementById('discountPercentage').value;
        const expiryDate = document.getElementById('expiryDate').value;
        const redemptionLimit = document.getElementById('redemptionLimit').value;
        const busId = document.getElementById('busId').value;

        const token = localStorage.getItem('token');

        fetch('http://localhost:5041/api/Coupon', {
            method: 'POST',
            headers: {
                'accept': '*/*',
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                code: code,
                discountPercentage: discountPercentage,
                expiryDate: expiryDate,
                redemptionLimit: redemptionLimit,
                busId: busId
            })
        })
            .then(response => response.json())
            .then(data => {
                document.getElementById('alertContainerCoupon').innerHTML = '<div class="alert alert-success">Coupon added successfully!</div>';
                // Optionally, you can redirect or clear the form here
            })
            .catch(error => {
                document.getElementById('alertContainerCoupon').innerHTML = '<div class="alert alert-danger">Error adding coupon: ' + error.message + '</div>';
                console.error('Error adding coupon:', error);
            });
    });

    function populateBusesDropdown() {
        const token = localStorage.getItem('token');

        fetch('http://localhost:5041/api/Bus', {
            method: 'GET',
            headers: {
                'accept': '*/*',
                'Authorization': `Bearer ${token}`
            }
        })
            .then(response => response.json())
            .then(buses => {
                const dropdown = document.getElementById('busId');
                dropdown.innerHTML = '<option value="">Select Bus</option>'; // Clear previous options
                buses.forEach(bus => {
                    const option = document.createElement('option');
                    option.value = bus.busId;
                    option.textContent = `Bus ${bus.busNumber}`;
                    dropdown.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Failed to fetch buses:', error);
            });
    }

    // Populate the buses dropdown on page load
    window.onload = populateBusesDropdown;
</script>
</body>

</html>
